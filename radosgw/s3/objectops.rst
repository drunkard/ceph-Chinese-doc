对象操作
========

上传对象
--------
把一个对象加进桶里。你必须有这个桶的写权限才能执行这个操作。


语法
~~~~
::

    PUT /{bucket}/{object} HTTP/1.1

请求头
~~~~~~

+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| 名称                 | 描述                                       | Valid Values                                                                  | 是否必需   |
+======================+============================================+===============================================================================+============+
| **content-md5**      | A base64 encoded MD-5 hash of the message. | A string. No defaults or constraints.                                         | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **content-type**     | A standard MIME type.                      | Any MIME type. Default: ``binary/octet-stream``                               | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **x-amz-meta-<...>** | User metadata.  Stored with the object.    | A string up to 8kb. No defaults.                                              | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **x-amz-acl**        | A canned ACL.                              | ``private``, ``public-read``, ``public-read-write``, ``authenticated-read``   | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+


复制对象
--------
.. Copy Object

复制对象用 ``PUT`` ，并指定一个目标桶和目标对象名字。

语法
~~~~
::

    PUT /{dest-bucket}/{dest-object} HTTP/1.1
    x-amz-copy-source: {source-bucket}/{source-object}

请求头
~~~~~~

+--------------------------------------+-------------------------------------------------+------------------------+------------+
| 名称                                 | 描述                                            | Valid Values           | 是否必需   |
+======================================+=================================================+========================+============+
| **x-amz-copy-source**                | The source bucket name + object name.           | {bucket}/{obj}         | Yes        |
+--------------------------------------+-------------------------------------------------+------------------------+------------+
| **x-amz-acl**                        | A canned ACL.                                   | ``private``,           | No         |
|                                      |                                                 | ``public-read``,       |            |
|                                      |                                                 | ``public-read-write``, |            |
|                                      |                                                 | ``authenticated-read`` |            |
+--------------------------------------+-------------------------------------------------+------------------------+------------+
| **x-amz-copy-if-modified-since**     |  Copies only if modified since the timestamp.   |   Timestamp            | No         |
+--------------------------------------+-------------------------------------------------+------------------------+------------+
| **x-amz-copy-if-unmodified-since**   |  Copies only if unmodified since the timestamp. |   Timestamp            | No         |
+--------------------------------------+-------------------------------------------------+------------------------+------------+
| **x-amz-copy-if-match**              |  Copies only if object ETag matches ETag.       |   Entity Tag           | No         |
+--------------------------------------+-------------------------------------------------+------------------------+------------+
| **x-amz-copy-if-none-match**         |  Copies only if object ETag doesn't match.      |   Entity Tag           | No         |
+--------------------------------------+-------------------------------------------------+------------------------+------------+

响应内容解析
~~~~~~~~~~~~

+------------------------+-------------+-----------------------------------------------+
| 名称                   | 类型        | 描述                                          |
+========================+=============+===============================================+
| **CopyObjectResult**   | Container   |  A container for the response elements.       |
+------------------------+-------------+-----------------------------------------------+
| **LastModified**       | Date        |  The last modified date of the source object. |
+------------------------+-------------+-----------------------------------------------+
| **Etag**               | String      |  The ETag of the new object.                  |
+------------------------+-------------+-----------------------------------------------+

删除对象
--------
.. Remove Object

删除一个对象，需要有对象所在桶的 **写权限** 。

语法
~~~~
::

    DELETE /{bucket}/{object} HTTP/1.1


下载对象
--------
.. Get Object

从 RADOS 内的一个桶里取回一个对象。

语法
~~~~
::

    GET /{bucket}/{object} HTTP/1.1

请求头
~~~~~~

+---------------------------+------------------------------------------------+--------------------------------+------------+
| 名称                      | 描述                                           | Valid Values                   | 是否必需   |
+===========================+================================================+================================+============+
| **range**                 | The range of the object to retrieve.           | Range: bytes=beginbyte-endbyte | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-modified-since**     | Gets only if modified since the timestamp.     | Timestamp                      | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-unmodified-since**   | Gets only if not modified since the timestamp. | Timestamp                      | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-match**              | Gets only if object ETag matches ETag.         | Entity Tag                     | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-none-match**         | Gets only if object ETag matches ETag.         | Entity Tag                     | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+

响应头
~~~~~~

+-------------------+--------------------------------------------------------------------------------------------+
| 名称              | 描述                                                                                       |
+===================+============================================================================================+
| **Content-Range** | Data range, will only be returned if the range header field was specified in the request   |
+-------------------+--------------------------------------------------------------------------------------------+

查看对象信息
------------
.. Get Object Info

返回对象的信息。这个请求会返回和“下载对象”请求一样的头部信息，
却只包含元数据，没有对象数据载荷。

语法
~~~~
::

    HEAD /{bucket}/{object} HTTP/1.1

请求头
~~~~~~

+---------------------------+------------------------------------------------+--------------------------------+------------+
| 名称                      | 描述                                           | Valid Values                   | 是否必需   |
+===========================+================================================+================================+============+
| **range**                 | The range of the object to retrieve.           | Range: bytes=beginbyte-endbyte | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-modified-since**     | Gets only if modified since the timestamp.     | Timestamp                      | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-unmodified-since**   | Gets only if not modified since the timestamp. | Timestamp                      | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-match**              | Gets only if object ETag matches ETag.         | Entity Tag                     | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+
| **if-none-match**         | Gets only if object ETag matches ETag.         | Entity Tag                     | No         |
+---------------------------+------------------------------------------------+--------------------------------+------------+

查看对象的 ACL
--------------
.. Get Object ACL

语法
~~~~

::

    GET /{bucket}/{object}?acl HTTP/1.1

响应内容解析
~~~~~~~~~~~~

+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| 名称                      | 类型        | 描述                                                                                         |
+===========================+=============+==============================================================================================+
| ``AccessControlPolicy``   | Container   | A container for the response.                                                                |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``AccessControlList``     | Container   | A container for the ACL information.                                                         |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Owner``                 | Container   | A container for the object owner's ``ID`` and ``Display名称``.                               |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``ID``                    | String      | The object owner's ID.                                                                       |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Display名称``           | String      | The object owner's display name.                                                             |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Grant``                 | Container   | A container for ``Grantee`` and ``Permission``.                                              |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Grantee``               | Container   | A container for the ``Display名称`` and ``ID`` of the user receiving a grant of permission.  |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Permission``            | String      | The permission given to the ``Grantee`` object.                                              |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+


设置对象的 ACL
--------------
.. Set Object ACL

语法
~~~~

::

    PUT /{bucket}/{object}?acl

请求实体
~~~~~~~~

+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| 名称                      | 类型        | 描述                                                                                         |
+===========================+=============+==============================================================================================+
| ``AccessControlPolicy``   | Container   | A container for the response.                                                                |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``AccessControlList``     | Container   | A container for the ACL information.                                                         |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Owner``                 | Container   | A container for the object owner's ``ID`` and ``Display名称``.                               |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``ID``                    | String      | The object owner's ID.                                                                       |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Display名称``           | String      | The object owner's display name.                                                             |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Grant``                 | Container   | A container for ``Grantee`` and ``Permission``.                                              |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Grantee``               | Container   | A container for the ``Display名称`` and ``ID`` of the user receiving a grant of permission.  |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+
| ``Permission``            | String      | The permission given to the ``Grantee`` object.                                              |
+---------------------------+-------------+----------------------------------------------------------------------------------------------+


初始化分段上传
--------------
.. Initiate Multi-part Upload

初始化一个分段上传进程。

语法
~~~~

::

    POST /{bucket}/{object}?uploads

请求头
~~~~~~

+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| 名称                 | 描述                                       | Valid Values                                                                  | 是否必需   |
+======================+============================================+===============================================================================+============+
| **content-md5**      | A base64 encoded MD-5 hash of the message. | A string. No defaults or constraints.                                         | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **content-type**     | A standard MIME type.                      | Any MIME type. Default: ``binary/octet-stream``                               | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **x-amz-meta-<...>** | User metadata.  Stored with the object.    | A string up to 8kb. No defaults.                                              | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **x-amz-acl**        | A canned ACL.                              | ``private``, ``public-read``, ``public-read-write``, ``authenticated-read``   | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+


响应内容解析
~~~~~~~~~~~~

+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| 名称                                    | 类型        | 描述                                                                                                     |
+=========================================+=============+==========================================================================================================+
| ``InitiatedMultipartUploadsResult``     | Container   | A container for the results.                                                                             |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Bucket``                              | String      | The bucket that will receive the object contents.                                                        |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Key``                                 | String      | The key specified by the ``key`` request parameter (if any).                                             |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``UploadId``                            | String      | The ID specified by the ``upload-id`` request parameter identifying the multipart upload (if any).       |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+


分段上传其中一块
----------------
.. Multipart Upload Part

语法
~~~~
::

    PUT /{bucket}/{object}?partNumber=&uploadId= HTTP/1.1

HTTP 响应
~~~~~~~~~

会返回下面的 HTTP 响应：

+---------------+----------------+--------------------------------------------------------------------------+
| HTTP Status   | Status Code    | 描述                                                                     |
+===============+================+==========================================================================+
| **404**       | NoSuchUpload   | Specified upload-id does not match any initiated upload on this object   |
+---------------+----------------+--------------------------------------------------------------------------+

罗列分段上传的数据块
--------------------
.. List Multipart Upload Parts

语法
~~~~
::

    GET /{bucket}/{object}?uploadId=123 HTTP/1.1

响应内容解析
~~~~~~~~~~~~

+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| 名称                                    | 类型        | 描述                                                                                                     |
+=========================================+=============+==========================================================================================================+
| ``ListPartsResult``                     | Container   | A container for the results.                                                                             |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Bucket``                              | String      | The bucket that will receive the object contents.                                                        |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Key``                                 | String      | The key specified by the ``key`` request parameter (if any).                                             |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``UploadId``                            | String      | The ID specified by the ``upload-id`` request parameter identifying the multipart upload (if any).       |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Initiator``                           | Container   | Contains the ``ID`` and ``Display名称`` of the user who initiated the upload.                            |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``ID``                                  | String      | The initiator's ID.                                                                                      |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Display名称``                         | String      | The initiator's display name.                                                                            |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Owner``                               | Container   | A container for the ``ID`` and ``Display名称`` of the user who owns the uploaded object.                 |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``StorageClass``                        | String      | The method used to store the resulting object. ``STANDARD`` or ``REDUCED_REDUNDANCY``                    |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``PartNumberMarker``                    | String      | The part marker to use in a subsequent request if ``IsTruncated`` is ``true``. Precedes the list.        |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``NextPartNumberMarker``                | String      | The next part marker to use in a subsequent request if ``IsTruncated`` is ``true``. The end of the list. |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``MaxParts``                            | Integer     | The max parts allowed in the response as specified by the ``max-parts`` request parameter.               |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``IsTruncated``                         | Boolean     | If ``true``, only a subset of the object's upload contents were returned.                                |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Part``                                | Container   | A container for ``LastModified``, ``PartNumber``, ``ETag`` and ``Size`` elements.                        |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``LastModified``                        | Date        | Date and time at which the part was uploaded.                                                            |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``PartNumber``                          | Integer     | The identification number of the part.                                                                   |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``ETag``                                | String      | The part's entity tag.                                                                                   |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+
| ``Size``                                | Integer     | The size of the uploaded part.                                                                           |
+-----------------------------------------+-------------+----------------------------------------------------------------------------------------------------------+


完成分段上传
------------
.. Complete Multipart Upload

组装上传的数据块并创建一个新对象，从而完成了一次分段上传。

语法
~~~~
::

    POST /{bucket}/{object}?uploadId= HTTP/1.1

请求实体
~~~~~~~~

+----------------------------------+-------------+-----------------------------------------------------+----------+
| 名称                             | 类型        | 描述                                                | 是否必需 |
+==================================+=============+=====================================================+==========+
| ``CompleteMultipartUpload``      | Container   | A container consisting of one or more parts.        | Yes      |
+----------------------------------+-------------+-----------------------------------------------------+----------+
| ``Part``                         | Container   | A container for the ``PartNumber`` and ``ETag``.    | Yes      |
+----------------------------------+-------------+-----------------------------------------------------+----------+
| ``PartNumber``                   | Integer     | The identifier of the part.                         | Yes      |
+----------------------------------+-------------+-----------------------------------------------------+----------+
| ``ETag``                         | String      | The part's entity tag.                              | Yes      |
+----------------------------------+-------------+-----------------------------------------------------+----------+


响应内容解析
~~~~~~~~~~~~

+-------------------------------------+-------------+-------------------------------------------------------+
| 名称                                | 类型        | 描述                                                  |
+=====================================+=============+=======================================================+
| **CompleteMultipartUploadResult**   | Container   | A container for the response.                         |
+-------------------------------------+-------------+-------------------------------------------------------+
| **Location**                        | URI         | The resource identifier (path) of the new object.     |
+-------------------------------------+-------------+-------------------------------------------------------+
| **Bucket**                          | String      | The name of the bucket that contains the new object.  |
+-------------------------------------+-------------+-------------------------------------------------------+
| **Key**                             | String      | The object's key.                                     |
+-------------------------------------+-------------+-------------------------------------------------------+
| **ETag**                            | String      | The entity tag of the new object.                     |
+-------------------------------------+-------------+-------------------------------------------------------+

中止多块上传
------------
.. Abort Multipart Upload

语法
~~~~
::

    DELETE /{bucket}/{object}?uploadId= HTTP/1.1


追加对象
--------
.. Append Object

向对象追加数据。你必须有桶的写权限才能执行此操作。这是用追加模式上传文件，
“追加对象（Append Object ）”操作创建的对象类型是“可追加对象（ Appendable Object ）”，
而用“上传对象（ Put Object ）”操作上传的对象类型是“普通对象（ Normal Object ）。
**如果这个桶开启或暂停了版本控制，就不能追加对象。**
**多站配置中，同步后会变成普通对象，但你仍然能向原始对象追加。**
**可追加对象的压缩和加密功能禁用了。**

语法
~~~~~~
::

    PUT /{bucket}/{object}?append&position= HTTP/1.1

请求头
~~~~~~

+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| 名称                 | 描述                                       | Valid Values                                                                  | 是否必需   |
+======================+============================================+===============================================================================+============+
| **content-md5**      | A base64 encoded MD-5 hash of the message. | A string. No defaults or constraints.                                         | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **content-type**     | A standard MIME type.                      | Any MIME type. Default: ``binary/octet-stream``                               | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **x-amz-meta-<...>** | User metadata.  Stored with the object.    | A string up to 8kb. No defaults.                                              | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+
| **x-amz-acl**        | A canned ACL.                              | ``private``, ``public-read``, ``public-read-write``, ``authenticated-read``   | No         |
+----------------------+--------------------------------------------+-------------------------------------------------------------------------------+------------+

响应头
~~~~~~

+--------------------------------+------------------------------------------------------------------+
| 名称                           | 描述                                                             |
+================================+==================================================================+
| **x-rgw-next-append-position** | Next position to append object                                   |
+--------------------------------+------------------------------------------------------------------+

HTTP 响应
~~~~~~~~~

会返回如下 HTTP 响应：

+---------------+----------------------------+---------------------------------------------------+
| HTTP Status   | Status Code                | 描述                                              |
+===============+============================+===================================================+
| **409**       | PositionNotEqualToLength   | Specified position does not match object length   |
+---------------+----------------------------+---------------------------------------------------+
| **409**       | ObjectNotAppendable        | Specified object can not be appended              |
+---------------+----------------------------+---------------------------------------------------+
| **409**       | InvalidBucketstate         | Bucket versioning is enabled or suspended         |
+---------------+----------------------------+---------------------------------------------------+

设置对象的保留时长（ Retention ）
---------------------------------
.. Put Object Retention

给一个对象配置保留时长（ Retention ）。

语法
~~~~
::

    PUT /{bucket}/{object}?retention&versionId= HTTP/1.1

请求实体
~~~~~~~~

+---------------------+-------------+-------------------------------------------------------------------------------+------------+
| 名称                | 类型        | 描述                                                                          |  是否必需  |
+=====================+=============+===============================================================================+============+
| ``Retention``       | Container   | A container for the request.                                                  |    Yes     |
+---------------------+-------------+-------------------------------------------------------------------------------+------------+
| ``Mode``            | String      | Retention mode for the specified object. Valid Values:  GOVERNANCE/COMPLIANCE |    Yes     |
+---------------------+-------------+--------------------------------------------------------------------------------------------+
| ``RetainUntilDate`` | Timestamp   | Retention date. Format: 2020-01-05T00:00:00.000Z                              |    Yes     |
+---------------------+-------------+--------------------------------------------------------------------------------------------+

查看对象的保留时长（ Retention ）
---------------------------------
.. Get Object Retention

查看对象的保留时长（ Retention ）配置。

语法
~~~~

::

    GET /{bucket}/{object}?retention&versionId= HTTP/1.1

响应内容解析
~~~~~~~~~~~~

+---------------------+-------------+-------------------------------------------------------------------------------+------------+
| 名称                | 类型        | 描述                                                                          |  是否必需  |
+=====================+=============+===============================================================================+============+
| ``Retention``       | Container   | A container for the request.                                                  |    Yes     |
+---------------------+-------------+-------------------------------------------------------------------------------+------------+
| ``Mode``            | String      | Retention mode for the specified object. Valid Values:  GOVERNANCE/COMPLIANCE |    Yes     |
+---------------------+-------------+--------------------------------------------------------------------------------------------+
| ``RetainUntilDate`` | Timestamp   | Retention date. Format: 2020-01-05T00:00:00.000Z                              |    Yes     |
+---------------------+-------------+--------------------------------------------------------------------------------------------+

设置对象的依法保留（ Legal Hold ）字段
--------------------------------------
.. Put Object Legal Hold

给指定对象设置依法保留（ Legal Hold ）字段。

语法
~~~~
::

    PUT /{bucket}/{object}?legal-hold&versionId= HTTP/1.1

请求实体
~~~~~~~~

+----------------+-------------+----------------------------------------------------------------------------------------+------------+
| 名称           | 类型        | 描述                                                                                   |  是否必需  |
+================+=============+========================================================================================+============+
| ``LegalHold``  | Container   | A container for the request.                                                           |    Yes     |
+----------------+-------------+----------------------------------------------------------------------------------------+------------+
| ``Status``     | String      | Indicates whether the specified object has a Legal Hold in place. Valid Values: ON/OFF |    Yes     |
+----------------+-------------+----------------------------------------------------------------------------------------+------------+

查看对象的依法保留（ Legal Hold ）配置
--------------------------------------
.. Get Object Legal Hold

查看一个对象当前的依法保留（ Legal Hold ）状态。

语法
~~~~
::

    GET /{bucket}/{object}?legal-hold&versionId= HTTP/1.1

响应内容解析
~~~~~~~~~~~~

+----------------+-------------+----------------------------------------------------------------------------------------+------------+
| 名称           | 类型        | 描述                                                                                   |  是否必需  |
+================+=============+========================================================================================+============+
| ``LegalHold``  | Container   | A container for the request.                                                           |    Yes     |
+----------------+-------------+----------------------------------------------------------------------------------------+------------+
| ``Status``     | String      | Indicates whether the specified object has a Legal Hold in place. Valid Values: ON/OFF |    Yes     |
+----------------+-------------+----------------------------------------------------------------------------------------+------------+

